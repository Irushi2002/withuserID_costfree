<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intern Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .nav-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #764ba2;
        }

        .page {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        .page.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid transparent;
        }

        .alert-success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .alert-danger {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        .alert-info {
            background: #cce7ff;
            border-color: #b3d7ff;
            color: #004085;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffeaa7;
            color: #856404;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #28a745;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .session-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #17a2b8;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .nav-buttons {
                flex-direction: column;
            }
            
            .nav-btn {
                width: 100%;
            }
            
            .two-column {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        .hidden {
            display: none;
        }

        .quality-score {
            font-size: 18px;
            font-weight: bold;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
        }

        .quality-high {
            background: #d4edda;
            color: #155724;
        }

        .quality-medium {
            background: #fff3cd;
            color: #856404;
        }

        .quality-low {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Intern Management System</h1>
            <p>AI-Powered Work Update Tracking with Quality Scoring</p>
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showPage('submit-work')">Submit Work Update</button>
                <button class="nav-btn" onclick="showPage('followup')">Follow-up Questions</button>
                <button class="nav-btn" onclick="showPage('quality-check')">Quality Analyzer</button>
                <button class="nav-btn" onclick="showPage('weekly-report')">Weekly Report</button>
                <button class="nav-btn" onclick="showPage('sessions')">My Sessions</button>
                <button class="nav-btn" onclick="showPage('system-status')">System Status</button>
            </div>
        </div>

        <!-- Submit Work Update Page -->
        <div id="submit-work" class="page active">
            <h2>Submit Daily Work Update</h2>
            <div id="submit-alert"></div>
            
            <form id="work-update-form">
                <div class="form-group">
                    <label for="user_id">User ID *</label>
                    <input type="text" id="user_id" name="user_id" required 
                           placeholder="Enter your intern/user ID (e.g., intern_john_123)">
                </div>

                <div class="form-group">
                    <label for="stack">Technology Stack *</label>
                    <select id="stack" name="stack" required>
                        <option value="">Select your stack</option>
                        <option value="Frontend Development">Frontend Development</option>
                        <option value="Backend Development">Backend Development</option>
                        <option value="Full Stack Development">Full Stack Development</option>
                        <option value="Mobile Development">Mobile Development</option>
                        <option value="DevOps">DevOps</option>
                        <option value="Data Science">Data Science</option>
                        <option value="UI/UX Design">UI/UX Design</option>
                        <option value="QA Testing">QA Testing</option>
                        <option value="Other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="task">Work Description *</label>
                    <textarea id="task" name="task" required 
                             placeholder="Describe what you worked on today. Be specific about tasks completed, technologies used, and outcomes achieved."></textarea>
                </div>

                <div class="form-group">
                    <label for="progress">Challenges & Progress</label>
                    <textarea id="progress" name="progress" 
                             placeholder="Describe any challenges you faced, how you overcame them, or progress made on ongoing tasks."></textarea>
                </div>

                <div class="form-group">
                    <label for="blockers">Plans & Blockers</label>
                    <textarea id="blockers" name="blockers" 
                             placeholder="Describe your plans for tomorrow or any blockers that need attention."></textarea>
                </div>

                <div class="form-group">
                    <label for="status">Work Status *</label>
                    <select id="status" name="status" required>
                        <option value="">Select status</option>
                        <option value="working">Working (In Office)</option>
                        <option value="wfh">Work From Home</option>
                        <option value="leave">On Leave</option>
                    </select>
                </div>

                <button type="submit" class="btn" id="submit-btn">Submit Work Update</button>
            </form>
        </div>

        <!-- Follow-up Questions Page -->
        <div id="followup" class="page">
            <h2>AI Follow-up Questions</h2>
            <div id="followup-alert"></div>

            <div class="form-group">
                <label for="followup_user_id">User ID *</label>
                <input type="text" id="followup_user_id" 
                       placeholder="Enter your user ID to start or continue follow-up">
            </div>

            <button onclick="startFollowup()" class="btn" id="start-followup-btn">Start Follow-up Session</button>

            <div id="followup-questions" class="hidden">
                <h3>Please answer the following questions:</h3>
                <div id="questions-container"></div>
                <button onclick="completeFollowup()" class="btn btn-success" id="complete-followup-btn">Complete Follow-up</button>
            </div>
        </div>

        <!-- Quality Analyzer Page -->
        <div id="quality-check" class="page">
            <h2>Work Quality Analyzer</h2>
            <p>Test your work description quality before submitting</p>
            <div id="quality-alert"></div>

            <div class="form-group">
                <label for="quality_user_id">User ID *</label>
                <input type="text" id="quality_user_id" 
                       placeholder="Enter your user ID">
            </div>

            <div class="form-group">
                <label for="quality_description">Work Description *</label>
                <textarea id="quality_description" 
                         placeholder="Paste your work description here to analyze its quality..."></textarea>
            </div>

            <button onclick="analyzeQuality()" class="btn">Analyze Quality</button>

            <div id="quality-results" class="hidden">
                <h3>Quality Analysis Results</h3>
                <div id="quality-score-display"></div>
                <div id="quality-details"></div>
            </div>
        </div>

        <!-- Weekly Report Page -->
        <div id="weekly-report" class="page">
            <h2>Generate Weekly Report</h2>
            <div id="report-alert"></div>

            <div class="form-group">
                <label for="report_user_id">User ID *</label>
                <input type="text" id="report_user_id" 
                       placeholder="Enter user ID for report generation">
            </div>

            <div class="two-column">
                <div class="form-group">
                    <label for="start_date">Start Date (optional)</label>
                    <input type="date" id="start_date">
                </div>

                <div class="form-group">
                    <label for="end_date">End Date (optional)</label>
                    <input type="date" id="end_date">
                </div>
            </div>

            <button onclick="generateReport()" class="btn" id="generate-report-btn">Generate Weekly Report</button>

            <div id="report-results" class="hidden">
                <h3>Weekly Report</h3>
                <div id="report-content"></div>
            </div>
        </div>

        <!-- My Sessions Page -->
        <div id="sessions" class="page">
            <h2>My Follow-up Sessions</h2>
            <div id="sessions-alert"></div>

            <div class="form-group">
                <label for="sessions_user_id">User ID *</label>
                <input type="text" id="sessions_user_id" 
                       placeholder="Enter your user ID to view sessions">
            </div>

            <button onclick="loadSessions()" class="btn">Load My Sessions</button>

            <div id="sessions-list"></div>
        </div>

        <!-- System Status Page -->
        <div id="system-status" class="page">
            <h2>System Status & Statistics</h2>
            <div id="status-alert"></div>

            <button onclick="loadSystemStatus()" class="btn">Refresh Status</button>
            <button onclick="testAIConnection()" class="btn btn-secondary">Test AI Connection</button>

            <div id="system-stats">
                <div class="loading">Loading system status...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentSessionId = null;
        let currentTempWorkUpdateId = null;

        // Page Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
        }

        // Utility Functions
        function showAlert(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                container.innerHTML = '';
            }, 5000);
        }

        function setLoading(buttonId, isLoading) {
            const button = document.getElementById(buttonId);
            if (isLoading) {
                button.disabled = true;
                button.innerHTML = 'Loading...';
            } else {
                button.disabled = false;
                button.innerHTML = button.getAttribute('data-original-text') || 'Submit';
            }
        }

        // Store original button texts
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('button').forEach(button => {
                button.setAttribute('data-original-text', button.innerHTML);
            });
            loadSystemStatus();
        });

        // Submit Work Update
        document.getElementById('work-update-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            // Set defaults for optional fields
            if (!data.progress) data.progress = "No challenges faced";
            if (!data.blockers) data.blockers = "No specific plans";
            
            setLoading('submit-btn', true);
            
            try {
                const response = await fetch(`${API_BASE}/api/work-updates`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    if (result.redirectToFollowup) {
                        currentTempWorkUpdateId = result.tempWorkUpdateId;
                        showAlert('submit-alert', 
                            `Work update submitted! Quality Score: ${result.qualityScore}/10. 
                             Follow-up questions are required. Click on "Follow-up Questions" tab to continue.`, 
                            'warning');
                    } else {
                        showAlert('submit-alert', 
                            `Work update completed successfully! ${result.message}`, 
                            'success');
                        this.reset();
                    }
                } else {
                    showAlert('submit-alert', `Error: ${result.message || result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('submit-alert', `Network error: ${error.message}`, 'danger');
            } finally {
                setLoading('submit-btn', false);
            }
        });

        // Start Follow-up Session
        async function startFollowup() {
            const userId = document.getElementById('followup_user_id').value.trim();
            if (!userId) {
                showAlert('followup-alert', 'Please enter your User ID', 'danger');
                return;
            }

            setLoading('start-followup-btn', true);

            try {
                const response = await fetch(`${API_BASE}/api/followups/start`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ user_id: userId })
                });

                const result = await response.json();

                if (result.success) {
                    currentSessionId = result.sessionId;
                    displayQuestions(result.questions);
                    showAlert('followup-alert', 
                        `Follow-up session started! Quality Score: ${result.qualityScore}/10`, 
                        'success');
                } else {
                    showAlert('followup-alert', `Error: ${result.message || result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('followup-alert', `Network error: ${error.message}`, 'danger');
            } finally {
                setLoading('start-followup-btn', false);
            }
        }

        // Display Questions
        function displayQuestions(questions) {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            questions.forEach((question, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                questionDiv.innerHTML = `
                    <label><strong>Question ${index + 1}:</strong></label>
                    <p>${question}</p>
                    <textarea id="answer_${index}" rows="3" 
                             placeholder="Please provide a detailed answer..."></textarea>
                `;
                container.appendChild(questionDiv);
            });

            document.getElementById('followup-questions').classList.remove('hidden');
        }

        // Complete Follow-up
        async function completeFollowup() {
            if (!currentSessionId) {
                showAlert('followup-alert', 'No active follow-up session', 'danger');
                return;
            }

            const userId = document.getElementById('followup_user_id').value.trim();
            const answers = [];
            
            for (let i = 0; i < 3; i++) {
                const answer = document.getElementById(`answer_${i}`).value.trim();
                if (!answer) {
                    showAlert('followup-alert', `Please answer question ${i + 1}`, 'danger');
                    return;
                }
                answers.push(answer);
            }

            setLoading('complete-followup-btn', true);

            try {
                const response = await fetch(`${API_BASE}/api/followup/${currentSessionId}/complete`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        answers: answers
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('followup-alert', 
                        'Follow-up completed successfully! Your work update has been saved to the system.', 
                        'success');
                    document.getElementById('followup-questions').classList.add('hidden');
                    document.getElementById('followup_user_id').value = '';
                    currentSessionId = null;
                } else {
                    showAlert('followup-alert', `Error: ${result.message || result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('followup-alert', `Network error: ${error.message}`, 'danger');
            } finally {
                setLoading('complete-followup-btn', false);
            }
        }

        // Analyze Quality
        async function analyzeQuality() {
            const userId = document.getElementById('quality_user_id').value.trim();
            const description = document.getElementById('quality_description').value.trim();

            if (!userId || !description) {
                showAlert('quality-alert', 'Please enter both User ID and work description', 'danger');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/quality/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        work_description: description
                    })
                });

                const result = await response.json();

                if (result.success) {
                    displayQualityResults(result);
                } else {
                    showAlert('quality-alert', `Error: ${result.message || result.detail}`, 'danger');
                }
            } catch (error) {
                showAlert('quality-alert', `Network error: ${error.message}`, 'danger');
            }
        }

        // Display Quality Results
        function displayQualityResults(result) {
            const scoreClass = result.quality_score >= 6 ? 'quality-high' : 
                              result.quality_score >= 4 ? 'quality-medium' : 'quality-low';

            document.getElementById('quality-score-display').innerHTML = `
                <div class="quality-score ${scoreClass}">
                    Quality Score: ${result.quality_score}/10
                    <br>
                    ${result.recommendation}
                </div>
            `;

            document.getElementById('quality-details').innerHTML = `
                <div class="card">
                    <h4>Analysis Details:</h4>
                    <p><strong>Word Count:</strong> ${result.analysis.word_count}</p>
                    <p><strong>Keywords Found:</strong> ${result.analysis.keyword_found ? 'Yes' : 'No'}</p>
                    <p><strong>Sentiment:</strong> ${result.analysis.sentiment_label} (${result.analysis.sentiment_polarity.toFixed(2)})</p>
                    <p><strong>Has Structure:</strong> ${result.analysis.has_structure ? 'Yes' : 'No'}</p>
                    <p><strong>Is Repetitive:</strong> ${result.analysis.is_repetition ? 'Yes' : 'No'}</p>
                    ${result.analysis.flag_reasons.length > 0 ? 
                        `<p><strong>Flags:</strong> ${result.analysis.flag_reasons.join(', ')}</p>` : ''}
                </div>
            `;

            document.getElementById('quality-results').classList.remove('hidden');
        }

        // Generate Weekly Report
        async function generateReport() {
            const userId = document.getElementById('report_user_id').value.trim();
            if (!userId) {
                showAlert('report-alert', 'Please enter User ID', 'danger');
                return;
            }

            const startDate = document.getElementById('start_date').value;
            const endDate = document.getElementById('end_date').value;

            setLoading('generate-report-btn', true);

            try {
                const body = { user_id: userId };
                if (startDate) body.start_date = startDate;
                if (endDate) body.end_date = endDate;

                const response = await fetch(`${API_BASE}/api/reports/weekly`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body)
                });

                const result = await response.json();

                if (result.success) {
                    document.getElementById('report-content').innerHTML = `
                        <div class="card">
                            <pre style="white-space: pre-wrap; font-family: inherit;">${result.report}</pre>
                        </div>
                        <div class="card">
                            <h4>Report Metadata:</h4>
                            <p><strong>Date Range:</strong> ${result.metadata.date_range.start} to ${result.metadata.date_range.end}</p>
                            <p><strong>Work Updates:</strong> ${result.metadata.data_summary?.work_updates_count || 0}</p>
                            <p><strong>Follow-up Sessions:</strong> ${result.metadata.data_summary?.followup_sessions_count || 0}</p>
                        </div>
                    `;
                    document.getElementById('report-results').classList.remove('hidden');
                    showAlert('report-alert', 'Weekly report generated successfully!', 'success');
                } else {
                    showAlert('report-alert', `Error: ${result.message}`, 'danger');
                }
            } catch (error) {
                showAlert('report-alert', `Network error: ${error.message}`, 'danger');
            } finally {
                setLoading('generate-report-btn', false);
            }
        }

        // Load Sessions
        async function loadSessions() {
            const userId = document.getElementById('sessions_user_id').value.trim();
            if (!userId) {
                showAlert('sessions-alert', 'Please enter User ID', 'danger');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/followup-sessions/list`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ user_id: userId })
                });

                const result = await response.json();

                if (result.success) {
                    displaySessions(result.sessions);
                    showAlert('sessions-alert', `Loaded ${result.count} sessions`, 'success');
                } else {
                    showAlert('sessions-alert', `Error: ${result.message}`, 'danger');
                }
            } catch (error) {
                showAlert('sessions-alert', `Network error: ${error.message}`, 'danger');
            }
        }

        // Display Sessions
        function displaySessions(sessions) {
            const container = document.getElementById('sessions-list');
            
            if (sessions.length === 0) {
                container.innerHTML = '<div class="card">No follow-up sessions found.</div>';
                return;
            }

            container.innerHTML = sessions.map(session => `
                <div class="session-item">
                    <h4>Session: ${session.sessionId}</h4>
                    <p><strong>Date:</strong> ${new Date(session.createdAt).toLocaleDateString()}</p>
                    <p><strong>Status:</strong> ${session.status}</p>
                    <p><strong>Quality Score:</strong> ${session.qualityScore || 'N/A'}</p>
                    <p><strong>Question Type:</strong> ${session.questionType || 'unknown'}</p>
                    ${session.completedAt ? `<p><strong>Completed:</strong> ${new Date(session.completedAt).toLocaleDateString()}</p>` : ''}
                    <details>
                        <summary>View Questions & Answers</summary>
                        <div style="margin-top: 10px;">
                            ${session.questions ? session.questions.map((q, i) => `
                                <p><strong>Q${i+1}:</strong> ${q}</p>
                                <p><strong>A${i+1}:</strong> ${session.answers && session.answers[i] ? session.answers[i] : 'Not answered'}</p>
                                <hr>
                            `).join('') : 'No questions available'}
                        </div>
                    </details>
                </div>
            `).join('');
        }

        // Load System Status
        async function loadSystemStatus() {
            try {
                const [healthResponse, statsResponse] = await Promise.all([
                    fetch(`${API_BASE}/health`),
                    fetch(`${API_BASE}/stats`)
                ]);

                const health = await healthResponse.json();
                const stats = await statsResponse.json();

                displaySystemStatus(health, stats);
            } catch (error) {
                document.getElementById('system-stats').innerHTML = `
                    <div class="alert alert-danger">
                        Failed to load system status: ${error.message}
                    </div>
                `;
            }
        }

        // Display System Status
        function displaySystemStatus(health, stats) {
            const statusColor = health.status === 'healthy' ? 'success' : 'danger';
            
            document.getElementById('system-stats').innerHTML = `
                <div class="alert alert-${statusColor}">
                    <strong>System Status:</strong> ${health.status.toUpperCase()}
                    <br><strong>Database:</strong> ${health.database}
                    <br><strong>TTL Cleanup:</strong> ${health.ttl_index}
                    <br><strong>Last Updated:</strong> ${new Date(health.timestamp).toLocaleString()}
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number">${stats.work_updates?.total || 0}</span>
                        <span class="stat-label">Total Work Updates</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.temp_work_updates?.pending || 0}</span>
                        <span class="stat-label">Pending Follow-ups</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${stats.followup_sessions?.completed || 0}</span>
                        <span class="stat-label">Completed Sessions</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">${health.rate_limiters?.followup_keys || 0}</span>
                        <span class="stat-label">Active API Keys</span>
                    </div>
                </div>

                <div class="card">
                    <h4>Quality Scoring System</h4>
                    <p><strong>Enabled:</strong> ${stats.quality_scoring?.enabled ? 'Yes' : 'No'}</p>
                    <p><strong>Threshold:</strong> ${stats.quality_scoring?.threshold}/10</p>
                    <p><strong>Keywords:</strong> ${stats.quality_scoring?.keywords_count} configured</p>
                </div>

                <div class="card">
                    <h4>Cleanup System</h4>
                    <p><strong>TTL Active:</strong> ${stats.cleanup_system?.ttl_index_active ? 'Yes' : 'No'}</p>
                    <p><strong>Cleanup Task:</strong> ${stats.cleanup_system?.manual_task_running ? 'Running' : 'Stopped'}</p>
                    <p><strong>Auto-deletion:</strong> ${stats.cleanup_system?.automatic_deletion}</p>
                </div>

                <div class="card">
                    <h4>API Keys Status</h4>
                    <p><strong>Follow-up Keys:</strong> ${stats.api_keys?.followup_keys}</p>
                    <p><strong>Weekly Report Keys:</strong> ${stats.api_keys?.weekly_report_keys}</p>
                    <p><strong>Total API Calls:</strong> ${stats.api_keys?.total_calls_recorded || 0}</p>
                    <p><strong>Rate Limit:</strong> ${stats.api_keys?.rate_limit_per_minute} calls/minute per key</p>
                </div>
            `;
        }

        // Test AI Connection
        async function testAIConnection() {
            try {
                showAlert('status-alert', 'Testing AI connections...', 'info');
                
                const response = await fetch(`${API_BASE}/api/ai/test`);
                const result = await response.json();

                if (result.success) {
                    showAlert('status-alert', 'AI connection test completed successfully!', 'success');
                } else {
                    showAlert('status-alert', `AI test failed: ${result.message}`, 'warning');
                }

                // Refresh status after test
                loadSystemStatus();
            } catch (error) {
                showAlert('status-alert', `AI test error: ${error.message}`, 'danger');
            }
        }
    </script>
</body>
</html>